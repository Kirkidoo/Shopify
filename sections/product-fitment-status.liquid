{% comment %}
  Section to display product fitment status based on last selected vehicle.
{% endcomment %}

{%- if section.settings.show_fitment_status and product -%}
  <div id="product-fitment-status-{{ section.id }}"
       class="product-fitment-status-container"
       data-section-id="{{ section.id }}"
       data-api-token="{{ settings.gamma_api_token }}"
       data-api-base-url="{{ settings.gamma_api_base_url }}"
       data-product-sku="{{ product.selected_or_first_available_variant.sku | default: product.variants.first.sku }}"
       data-fits-message="{{ section.settings.fits_message | escape }}"
       data-does-not-fit-message="{{ section.settings.does_not_fit_message | escape }}"
       data-no-vehicle-selected-message="{{ section.settings.no_vehicle_selected_message | escape }}"
       data-api-error-message="{{ section.settings.api_error_message | escape }}"
  >
    <!-- Content will be injected by JavaScript -->
    <p class="fitment-status-placeholder">Loading fitment status...</p>
  </div>
{%- endif -%}

{% schema %}
{
  "name": "Product Fitment Status",
  "tag": "section",
  "class": "product-fitment-status-section",
  "settings": [
    {
      "type": "checkbox",
      "id": "show_fitment_status",
      "label": "Show Product Fitment Status",
      "default": true,
      "info": "Enable this to display the fitment status on product pages."
    },
    {
      "type": "text",
      "id": "fits_message",
      "label": "Product Fits Message",
      "default": "This product fits your {vehicle_name}.",
      "info": "Use {vehicle_name} as a placeholder for the selected vehicle name."
    },
    {
      "type": "text",
      "id": "does_not_fit_message",
      "label": "Product Does Not Fit Message",
      "default": "This product does not fit your {vehicle_name}.",
      "info": "Use {vehicle_name} as a placeholder for the selected vehicle name."
    },
    {
      "type": "text",
      "id": "no_vehicle_selected_message",
      "label": "No Vehicle Selected Message",
      "default": "Select your vehicle using the Product Finder to check fitment.",
      "info": "Message shown if no vehicle has been selected in the Product Finder."
    },
    {
      "type": "text",
      "id": "api_error_message",
      "label": "API Error Message",
      "default": "Could not retrieve fitment information at this time. Please try again later.",
      "info": "Message shown if there's an issue communicating with the fitment API."
    }
  ],
  "presets": [
    {
      "name": "Product Fitment Status",
      "category": "Product"
    }
  ]
}
{% endschema %}

{{ 'product-fitment-status.css' | asset_url | stylesheet_tag }}
<script src="{{ 'product-fitment-status.js' | asset_url }}" defer="defer"></script>
